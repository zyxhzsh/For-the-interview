### 连接查询

在实际开发中查询数据，一般都是多张表联合查询取出最终的结果。多张表联合查询数据就叫连接查询。

**连接查询的分类**

根据语法出现的年代来划分的话，包括：

	SQL92（一些老的DBA可能还在使用这种语法。DBA：DataBase Administrator，数据库管理员）			
	
	SQL99（比较新的语法）	

根据表的连接方式来划分，包括：

	内连接：
		等值连接
		非等值连接
		自连接
				
	外连接：
		左外连接（左连接）
		右外连接（右连接）
		
	全连接（很少用）

**表的别名**

连接查询一定要给表起别名，因为两张表可能有字段名相同的情况。

表的别名执行效率高，可读性好。

**笛卡尔积现象**

当两张表进行连接查询的时候，如果没有任何条件进行限制，最终的查询结果条数是两张表记录条数的乘积。

怎么避免笛卡尔积现象？

加条件进行过滤。过滤不会减少记录的匹配次数，只不过显示的是有效记录。所以加了过滤程序的执行效率不会变。

[内连接](#内连接)

[外连接](#外连接)

[内连接和外连接的区别](#内连接和外连接的区别)

[三张以上表的连接](#三张以上表的连接)

### 内连接

**等值连接**

内连接之等值连接：连接条件中的关系是等量关系。

（1）找出每一个员工的部门名称，要求显示员工名和部门名。

99语法中，表连接的条件 和 连接后进行数据过滤的条件(where)分离了，结构更清晰。

```
select 
	e.ename, d.dname 
from 
	emp e, dept d 
where 
	e.deptno = d.deptno;#92语法，现已不用。

#99语法
select
	e.ename,d.dname
from
	emp e
inner join#inner可以省略，默认为内连接，带inner可读性
	dept d
on
	e.deptno = d.deptno;
```

**非等值连接**

内连接之非等值连接：连接条件中的关系是非等量关系。

（1）找出每个员工的工资等级，要求显示员工名、工资、工资等级。

```
select
	e.ename,e.sal,s.grade
from
	emp e
inner join
	salgrade s
on
  e.sal between s.losal and s.hisal;
```

**自连接**

内连接之自连接：一张表看作两张表，自己连自己。

（1）找出每个员工的上级领导，要求显示员工名和对应的领导名。

```
#弄清楚连接条件：员工的领导编号等于领导的员工编号
#king没有上级领导，所以不会包含king的记录。
select 
	a.ename as '员工名',b.ename as '领导名'
from
	emp a
inner join
	emp b
on
	a.mgr = b.empno;
```

### 外连接

**特点**：主表的数据无条件的全部查询出来。

左外连接（左连接）：表示左边的这张表是主表。a left outer join b

右外连接（右连接）：表示右边的这张表是主表。a right outer join b

左连接有右连接的写法，右连接也会有对应的左连接的写法。outer可以省略。

（1）找出每个员工的上级领导。

意思是要每个员工的记录，没有领导也要查出来。如果使用内连接不能匹配就不查询了，而外连接可以把员工表作为主表，主要是为了把所有员工都查出来，捎带查员工的上级领导。不能因为没有上级领导就把员工记录丢失了。

```
select
	a.ename,b.ename
from
	emp a
left outer join
	emp b
on
	a.mgr=b.empno;
```

（2）找出哪个部门没有员工？

```
select 
	d.*
from
	dept d
left outer join
	emp e
on
	e.deptno = d.deptno
where
	e.empno is null;
```

### 内连接和外连接的区别

内连接每个表示平等的，外连接表之间有主次之分。

	内连接：
		假设A和B表进行连接，使用内连接的话，凡是A表和B表能够匹配上的记录查询出来，这就是内连接。
		AB两张表没有主副之分，两张表是平等的。
	
	外连接：
		假设A和B表进行连接，使用外连接的话，AB两张表中有一张表是主表，一张表是副表，主要查询主表中
		的数据，捎带着查询副表，当副表中的数据没有和主表中的数据匹配上，副表自动模拟出NULL与之匹配。

### 三张以上表的连接

（1）找出每一个员工的部门名称以及工资等级。

```
select 
  e.ename,d.dname,s.grade
from 
  emp e
join
  dept d
on
  e.deptno=d.deptno
join 
  salgrade s
on 
  e.sal between s.losal and s.hisal;
```

（2）找出每一个员工的部门名称、工资等级、以及上级领导。

```
select 
  a.ename '员工',d.dname,s.grade,b.ename '领导'
from 
  emp a
join
  dept d
on
  a.deptno=d.deptno
join 
  salgrade s
on 
  a.sal between s.losal and s.hisal
left outer join 
  emp b
on a.mgr=b.empno;
```

